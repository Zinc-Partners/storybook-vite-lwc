<template>
  <c-theme-provider>
    <div class={containerClass}>
      <!-- Label -->
      <template lwc:if={hasLabel}>
        <label class={labelClass} for="input-field">
          {label}
          <template lwc:if={required}>
            <span class="procrewz-input-required">{requiredIndicator}</span>
          </template>
        </label>
      </template>

      <!-- Input Wrapper -->
      <div class={inputWrapperClass}>
        <!-- Prefix -->
        <template lwc:if={hasPrefix}>
          <span class="procrewz-input-prefix"> {prefix} </span>
        </template>

        <!-- Input -->
        <input
          id="input-field"
          class={inputClass}
          type={computedInputType}
          name={name}
          value={value}
          placeholder={placeholder}
          disabled={disabled}
          readonly={readonly}
          required={required}
          maxlength={maxLength}
          minlength={minLength}
          min={min}
          max={max}
          step={step}
          pattern={pattern}
          autocomplete={autoComplete}
          aria-invalid={hasError}
          aria-describedby={ariaDescribedBy}
          aria-label={ariaLabel}
          oninput={handleInput}
          onfocus={handleFocus}
          onblur={handleBlur}
          onkeydown={handleKeyDown}
          onkeyup={handleKeyUp}
        />

        <!-- Icon (auto-detected or explicit) -->
        <template lwc:if={hasIcon}>
          <template lwc:if={isClockIconClickable}>
            <!-- Clickable Clock Icon for Time Picker -->
            <button
              type="button"
              class="procrewz-input-icon procrewz-input-icon--clickable"
              aria-label="Open time picker"
              onclick={handleToggleTimePicker}
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
            </button>
          </template>
          <template lwc:elseif={isCalendarIconClickable}>
            <!-- Clickable Calendar Icon for Date Picker -->
            <button
              type="button"
              class="procrewz-input-icon procrewz-input-icon--clickable"
              aria-label="Open date picker"
              onclick={handleToggleDatePicker}
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
            </button>
          </template>
          <template lwc:else>
            <span class="procrewz-input-icon">
              <!-- Search Icon -->
              <template lwc:if={isSearchIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
              </template>

              <!-- Email Icon -->
              <template lwc:if={isEmailIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                  <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                </svg>
              </template>

              <!-- Calendar Icon (non-clickable) -->
              <template lwc:if={isCalendarIconNonClickable}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </template>

              <!-- Credit Card Icon -->
              <template lwc:if={isCreditCardIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                  <line x1="1" y1="10" x2="23" y2="10"></line>
                </svg>
              </template>

              <!-- Phone Icon -->
              <template lwc:if={isPhoneIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                  ></path>
                </svg>
              </template>

              <!-- Clock Icon (non-clickable) -->
              <template lwc:if={isClockIconNonClickable}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
              </template>
            </span>
          </template>
        </template>

        <!-- Clear Button -->
        <template lwc:if={showClearButton}>
          <button
            type="button"
            class="procrewz-input-clear"
            aria-label="Clear input"
            onclick={handleClear}
            onkeyup={handleClearKeyUp}
          >
            <svg
              class="procrewz-input-clear-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </template>

        <!-- Password Toggle Button -->
        <template lwc:if={showPasswordToggle}>
          <button
            type="button"
            class="procrewz-input-password-toggle"
            aria-label={passwordToggleLabel}
            onclick={handleTogglePassword}
            onkeyup={handleTogglePasswordKeyUp}
          >
            <!-- Eye Open Icon (password hidden - click to show) -->
            <template lwc:if={passwordVisible}>
              <svg
                class="procrewz-input-password-icon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"
                ></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </template>
            <!-- Eye Closed Icon (password visible - click to hide) -->
            <template lwc:else>
              <svg
                class="procrewz-input-password-icon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </template>
          </button>
        </template>

        <!-- Suffix -->
        <template lwc:if={hasSuffix}>
          <span class="procrewz-input-suffix"> {suffix} </span>
        </template>

        <!-- Time Picker Dropdown -->
        <template lwc:if={showTimePicker}>
          <div class={timePickerClass} onclick={handleTimePickerClick}>
            <!-- Columns Container -->
            <div class="procrewz-time-picker__columns">
              <!-- Hours Column -->
              <div class="procrewz-time-picker__column" data-column="hour">
                <template for:each={hours} for:item="hour">
                  <button
                    key={hour.value}
                    type="button"
                    class={hour.class}
                    data-type="hour"
                    data-value={hour.value}
                    onclick={handleTimeSelection}
                  >
                    {hour.label}
                  </button>
                </template>
              </div>

              <!-- Minutes Column -->
              <div class="procrewz-time-picker__column" data-column="minute">
                <template for:each={minutes} for:item="minute">
                  <button
                    key={minute.value}
                    type="button"
                    class={minute.class}
                    data-type="minute"
                    data-value={minute.value}
                    onclick={handleTimeSelection}
                  >
                    {minute.label}
                  </button>
                </template>
              </div>

              <!-- Seconds Column (optional) -->
              <template lwc:if={showSeconds}>
                <div class="procrewz-time-picker__column" data-column="second">
                  <template for:each={seconds} for:item="second">
                    <button
                      key={second.value}
                      type="button"
                      class={second.class}
                      data-type="second"
                      data-value={second.value}
                      onclick={handleTimeSelection}
                    >
                      {second.label}
                    </button>
                  </template>
                </div>
              </template>

              <!-- AM/PM Column -->
              <div
                class="procrewz-time-picker__column procrewz-time-picker__column--period"
              >
                <button
                  type="button"
                  class={amClass}
                  data-type="period"
                  data-value="AM"
                  onclick={handleTimeSelection}
                >
                  AM
                </button>
                <button
                  type="button"
                  class={pmClass}
                  data-type="period"
                  data-value="PM"
                  onclick={handleTimeSelection}
                >
                  PM
                </button>
              </div>
            </div>

            <!-- Footer with Cancel/OK -->
            <div class="procrewz-time-picker__footer">
              <button
                type="button"
                class="procrewz-time-picker__btn procrewz-time-picker__btn--cancel"
                onclick={handleTimePickerCancel}
              >
                Cancel
              </button>
              <button
                type="button"
                class="procrewz-time-picker__btn procrewz-time-picker__btn--ok"
                onclick={handleTimePickerOk}
              >
                OK
              </button>
            </div>
          </div>
        </template>

        <!-- Date Picker Dropdown -->
        <template lwc:if={showDatePicker}>
          <div class={datePickerClass} onclick={handleDatePickerClick}>
            <!-- Header: Navigation + Month/Year Dropdowns -->
            <div class="procrewz-date-picker__header">
              <!-- Previous Month Button -->
              <button
                type="button"
                class="procrewz-date-picker__nav-btn"
                aria-label="Previous month"
                onclick={handlePrevMonth}
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
              </button>

              <!-- Month/Year Selectors -->
              <div class="procrewz-date-picker__selectors">
                <!-- Month Dropdown -->
                <div class="procrewz-date-picker__month-selector">
                  <button
                    type="button"
                    class="procrewz-date-picker__selector-btn"
                    aria-haspopup="listbox"
                    aria-expanded={monthDropdownOpen}
                    onclick={handleMonthDropdownToggle}
                  >
                    {shortMonthLabel}
                    <svg
                      class="procrewz-date-picker__chevron"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                  <div class={monthDropdownClass}>
                    <div
                      class="procrewz-date-picker__dropdown-list"
                      role="listbox"
                    >
                      <template for:each={calendarMonths} for:item="month">
                        <button
                          key={month.value}
                          type="button"
                          role="option"
                          class={month.class}
                          aria-selected={month.selected}
                          data-value={month.value}
                          onclick={handleMonthSelect}
                        >
                          {month.shortLabel}
                        </button>
                      </template>
                    </div>
                  </div>
                </div>

                <!-- Year Dropdown -->
                <div class="procrewz-date-picker__year-selector">
                  <button
                    type="button"
                    class="procrewz-date-picker__selector-btn"
                    aria-haspopup="listbox"
                    aria-expanded={yearDropdownOpen}
                    onclick={handleYearDropdownToggle}
                  >
                    {currentYear}
                    <svg
                      class="procrewz-date-picker__chevron"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                  <div
                    class="procrewz-date-picker__dropdown procrewz-date-picker__year-dropdown"
                    data-open={yearDropdownOpen}
                  >
                    <div
                      class="procrewz-date-picker__dropdown-list procrewz-date-picker__dropdown-list--scrollable"
                      role="listbox"
                    >
                      <template for:each={calendarYears} for:item="year">
                        <button
                          key={year.value}
                          type="button"
                          role="option"
                          class={year.class}
                          aria-selected={year.selected}
                          data-value={year.value}
                          onclick={handleYearSelect}
                        >
                          {year.label}
                        </button>
                      </template>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Next Month Button -->
              <button
                type="button"
                class="procrewz-date-picker__nav-btn"
                aria-label="Next month"
                onclick={handleNextMonth}
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </button>
            </div>

            <!-- Weekday Headers -->
            <div class="procrewz-date-picker__weekdays">
              <template for:each={weekdays} for:item="day">
                <div key={day} class="procrewz-date-picker__weekday">{day}</div>
              </template>
            </div>

            <!-- Calendar Grid -->
            <div class="procrewz-date-picker__grid" role="grid">
              <template
                for:each={calendarDays}
                for:item="week"
                for:index="weekIndex"
              >
                <div
                  key={week.key}
                  class="procrewz-date-picker__week"
                  role="row"
                >
                  <template
                    for:each={week.days}
                    for:item="dayItem"
                    for:index="dayIndex"
                  >
                    <button
                      key={dayItem.key}
                      type="button"
                      role="gridcell"
                      class={dayItem.class}
                      aria-label={dayItem.ariaLabel}
                      aria-selected={dayItem.isSelected}
                      data-week={weekIndex}
                      data-day={dayIndex}
                      onclick={handleDayClick}
                    >
                      {dayItem.day}
                    </button>
                  </template>
                </div>
              </template>
            </div>
          </div>
        </template>
      </div>

      <!-- Helper Text -->
      <template lwc:if={showHelperText}>
        <span id="helper-text" class={helperTextClass}> {helpText} </span>
      </template>

      <!-- Error Message -->
      <template lwc:if={showErrorMessage}>
        <span
          id="error-message"
          class="procrewz-input-helper procrewz-input-helper--error"
          role="alert"
        >
          {errorMessage}
        </span>
      </template>
    </div>
  </c-theme-provider>
</template>
