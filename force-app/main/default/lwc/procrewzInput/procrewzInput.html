<template>
  <c-theme-provider>
    <div class={containerClass}>
      <!-- Label -->
      <template lwc:if={hasLabel}>
        <label class={labelClass} for="input-field">
          {label}
          <template lwc:if={required}>
            <span class="procrewz-input-required">{requiredIndicator}</span>
          </template>
        </label>
      </template>

      <!-- Input Wrapper -->
      <div class={inputWrapperClass}>
        <!-- Prefix -->
        <template lwc:if={hasPrefix}>
          <span class="procrewz-input-prefix"> {prefix} </span>
        </template>

        <!-- Input -->
        <input
          id="input-field"
          class={inputClass}
          type={computedInputType}
          name={name}
          value={value}
          placeholder={placeholder}
          disabled={disabled}
          readonly={readonly}
          required={required}
          maxlength={maxLength}
          minlength={minLength}
          min={min}
          max={max}
          step={step}
          pattern={pattern}
          autocomplete={autoComplete}
          aria-invalid={hasError}
          aria-describedby={ariaDescribedBy}
          aria-label={ariaLabel}
          oninput={handleInput}
          onfocus={handleFocus}
          onblur={handleBlur}
          onkeydown={handleKeyDown}
          onkeyup={handleKeyUp}
        />

        <!-- Icon (auto-detected or explicit) -->
        <template lwc:if={hasIcon}>
          <template lwc:if={isClockIconClickable}>
            <!-- Clickable Clock Icon for Time Picker -->
            <button
              type="button"
              class="procrewz-input-icon procrewz-input-icon--clickable"
              aria-label="Open time picker"
              onclick={handleToggleTimePicker}
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
            </button>
          </template>
          <template lwc:else>
            <span class="procrewz-input-icon">
              <!-- Search Icon -->
              <template lwc:if={isSearchIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
              </template>

              <!-- Email Icon -->
              <template lwc:if={isEmailIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                  <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                </svg>
              </template>

              <!-- Calendar Icon -->
              <template lwc:if={isCalendarIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </template>

              <!-- Credit Card Icon -->
              <template lwc:if={isCreditCardIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                  <line x1="1" y1="10" x2="23" y2="10"></line>
                </svg>
              </template>

              <!-- Phone Icon -->
              <template lwc:if={isPhoneIcon}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                  ></path>
                </svg>
              </template>

              <!-- Clock Icon (non-clickable) -->
              <template lwc:if={isClockIconNonClickable}>
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
              </template>
            </span>
          </template>
        </template>

        <!-- Clear Button -->
        <template lwc:if={showClearButton}>
          <button
            type="button"
            class="procrewz-input-clear"
            aria-label="Clear input"
            onclick={handleClear}
            onkeyup={handleClearKeyUp}
          >
            <svg
              class="procrewz-input-clear-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </template>

        <!-- Password Toggle Button -->
        <template lwc:if={showPasswordToggle}>
          <button
            type="button"
            class="procrewz-input-password-toggle"
            aria-label={passwordToggleLabel}
            onclick={handleTogglePassword}
            onkeyup={handleTogglePasswordKeyUp}
          >
            <!-- Eye Open Icon (password hidden - click to show) -->
            <template lwc:if={passwordVisible}>
              <svg
                class="procrewz-input-password-icon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"
                ></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </template>
            <!-- Eye Closed Icon (password visible - click to hide) -->
            <template lwc:else>
              <svg
                class="procrewz-input-password-icon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </template>
          </button>
        </template>

        <!-- Suffix -->
        <template lwc:if={hasSuffix}>
          <span class="procrewz-input-suffix"> {suffix} </span>
        </template>

        <!-- Time Picker Dropdown -->
        <template lwc:if={showTimePicker}>
          <div class={timePickerClass} onclick={handleTimePickerClick}>
            <!-- Columns Container -->
            <div class="procrewz-time-picker__columns">
              <!-- Hours Column -->
              <div class="procrewz-time-picker__column" data-column="hour">
                <template for:each={hours} for:item="hour">
                  <button
                    key={hour.value}
                    type="button"
                    class={hour.class}
                    data-type="hour"
                    data-value={hour.value}
                    onclick={handleTimeSelection}
                  >
                    {hour.label}
                  </button>
                </template>
              </div>

              <!-- Minutes Column -->
              <div class="procrewz-time-picker__column" data-column="minute">
                <template for:each={minutes} for:item="minute">
                  <button
                    key={minute.value}
                    type="button"
                    class={minute.class}
                    data-type="minute"
                    data-value={minute.value}
                    onclick={handleTimeSelection}
                  >
                    {minute.label}
                  </button>
                </template>
              </div>

              <!-- Seconds Column (optional) -->
              <template lwc:if={showSeconds}>
                <div class="procrewz-time-picker__column" data-column="second">
                  <template for:each={seconds} for:item="second">
                    <button
                      key={second.value}
                      type="button"
                      class={second.class}
                      data-type="second"
                      data-value={second.value}
                      onclick={handleTimeSelection}
                    >
                      {second.label}
                    </button>
                  </template>
                </div>
              </template>

              <!-- AM/PM Column -->
              <div
                class="procrewz-time-picker__column procrewz-time-picker__column--period"
              >
                <button
                  type="button"
                  class={amClass}
                  data-type="period"
                  data-value="AM"
                  onclick={handleTimeSelection}
                >
                  AM
                </button>
                <button
                  type="button"
                  class={pmClass}
                  data-type="period"
                  data-value="PM"
                  onclick={handleTimeSelection}
                >
                  PM
                </button>
              </div>
            </div>

            <!-- Footer with Cancel/OK -->
            <div class="procrewz-time-picker__footer">
              <button
                type="button"
                class="procrewz-time-picker__btn procrewz-time-picker__btn--cancel"
                onclick={handleTimePickerCancel}
              >
                Cancel
              </button>
              <button
                type="button"
                class="procrewz-time-picker__btn procrewz-time-picker__btn--ok"
                onclick={handleTimePickerOk}
              >
                OK
              </button>
            </div>
          </div>
        </template>
      </div>

      <!-- Helper Text -->
      <template lwc:if={showHelperText}>
        <span id="helper-text" class={helperTextClass}> {helpText} </span>
      </template>

      <!-- Error Message -->
      <template lwc:if={showErrorMessage}>
        <span
          id="error-message"
          class="procrewz-input-helper procrewz-input-helper--error"
          role="alert"
        >
          {errorMessage}
        </span>
      </template>
    </div>
  </c-theme-provider>
</template>
